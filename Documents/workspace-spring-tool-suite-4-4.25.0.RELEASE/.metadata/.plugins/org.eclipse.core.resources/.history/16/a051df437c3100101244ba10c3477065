<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Billing Page</title>
	<link rel="stylesheet" href="/css/Billing.css" />
	<style>
		.suggestion-list {
		  position: absolute;
		  background-color: #ffffff; /* Background */
		  border: 1px solid #ccc;
		  width: 200px;
		  max-height: 150px;
		  overflow-y: auto;
		  list-style-type: none;
		  padding: 0;
		  margin-top: 2px;
		  z-index: 1000;
		  border-radius: 5px;
		}

		.suggestion-list li {
		  padding: 8px;
		  cursor: pointer;
		  color: #333;
		}

		.suggestion-list li:hover {
		  background-color: #3C949E; /* Your primary color */
		  color: #fff;
		}
		.dropdown-container {
		  position: relative;
		  display: inline-block;
		  width: 200px;
		}

		.suggestion-list {
		  position: absolute;
		  top: 100%;
		  left: 0;
		  width: 100%;
		  background-color: #ffffff;
		  border: 1px solid #ccc;
		  max-height: 150px;
		  overflow-y: auto;
		  list-style-type: none;
		  padding: 0;
		  margin: 0;
		  z-index: 1000;
		}
		
		

		.suggestion-listss {
				  position: absolute;
				  background-color: #ffffff; /* Background */
				  border: 1px solid #ccc;
				  width: 200px;
				  max-height: 150px;
				  overflow-y: auto;
				  list-style-type: none;
				  padding: 0;
				  margin-top: 2px;
				  z-index: 1000;
				}

				.suggestion-listss li {
				  padding: 8px;
				  cursor: pointer;
				  color: #333;
				}

				.suggestion-listss li:hover {
				  background-color: #3C949E; /* Your primary color */
				  color: #fff;
				}
				.dropdown-container {
				  position: relative;
				  display: inline-block;
				  width: 200px;
				}

				.suggestion-listss {
				  position: absolute;
				  top: 100%;
				  left: 0;
				  width: 100%;
				  background-color: #ffffff;
				  border: 1px solid #ccc;
				  max-height: 150px;
				  overflow-y: auto;
				  list-style-type: none;
				  padding: 0;
				  margin: 0;
				  z-index: 1000;
				}

	</style>
	
  </head>
  <body>
	<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #3C949E;">
			<div class="container d-flex align-items-center">
				<img th:src=@{/image/Logo.png} class="logo" width="50" height="50"/>
				<a class="navbar-brand d-flex align-items-center" th:href="@{/}" style="color: white; font-weight: bold;">Fundamental HMS</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
					aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav ms-auto">
						<li class="nav-item">
							<a class="nav-link active" th:href="@{/}" style="color: white;">Home</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href="@{/features}" style="color: white;">About</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" th:href="@{/contact}" style="color: white;">Profile</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>
    <div class="toolbar">
      <button>NEW</button>
      <button>SAVE</button>
      <button>SUBMIT</button>
      <button>BILL</button>
      <button>PRINT</button>
	  <a href="/">
      <button>CLOSE</button></a>
    </div>

    <div class="billing-form">
      <!-- Patient and Bill Info -->
      <div class="form-row">
        <label>Bill Number</label
        ><input type="text" id="billNumber" value="TRBD1153" />
        <label>Date</label><input type="datetime-local" id="billDate" />
      </div>

      <div class="form-row">
		<label>OP/IP Number</label><input type="text" id="patientName" />
        <label>Patient ID</label><input type="text" id="patientId" />
        <label>Patient Name</label><input type="text" id="patientName" />
      </div>

      <div class="form-row">
        <label>Doctor Name</label><input type="text" id="doctorName" />
        <label>Sex</label>
        <select id="sex">
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>
        <label>Age</label><input type="number" id="age" style="width: 60px" />
      </div>

      <div class="form-row">
        <label>Type</label>
        <select id="type">
          <option>General</option>
          <option>Emergency</option>
        </select>
        <label>Payment Mode</label>
        <select id="paymentMode">
          <option>Cash</option>
          <option>Credit</option>
          <option>Card</option>
        </select>
      </div>

      <div class="form-row">
        <label>Bill Amount</label
        ><input type="number" id="billAmount" readonly /> <label>Received</label
        ><input type="number" id="receivedAmount" /> <label>Balance</label
        ><input type="number" id="balanceAmount" readonly />
      </div>

      <hr />

    
<h4 class="section-header">Billing Items</h4>
<div class="item-entry-horizontal">
	<div class="dropdown-container">
  <input type="text" placeholder="Code" id="itemcode" autocomplete="off" >
  <ul id="suggestionListss" class="suggestion-listss"></ul>
	</div>
  <div class="dropdown-container">
    <input type="text" id="itemname" placeholder="Search Item Name" autocomplete="off" />
    <ul id="suggestionList" class="suggestion-list"></ul>
  </div>
<input type="number" placeholder="Amount" id="fee">
  <input type="number" placeholder="Disc.%" id="itemDisc">
  <input type="number" placeholder="P.Disc.%" id="itemPDisc">
  <input type="text" placeholder="Remarks" id="remarks">
  <button onclick="addItem()">ADD</button>
</div>

<!-- Billing Items Table -->
<table class="item-table modern">
  <thead>
    <tr>
      <th>Del</th>
      <th>Code</th>
      <th>Name</th>
      <th>Amount</th>
      <th>Disc.%</th>
      <th>Disc.</th>
      <th>P.Disc.%</th>
      <th>P.Disc.</th>
      <th>Total Disc.</th>
      <th>Remarks</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>



   <script>
      function addItem() {
        const code = document.getElementById("itemcode").value;
        const name = document.getElementById("itemname").value;
        const amount =
          parseFloat(document.getElementById("fee").value) || 0;
        const disc = parseFloat(document.getElementById("itemDisc").value) || 0;
        const pdisc =
          parseFloat(document.getElementById("itemPDisc").value) || 0;
        const remarks = document.getElementById("remarks").value;

        const discAmt = (amount * disc) / 100;
        const pdiscAmt = (amount * pdisc) / 100;
        const totalDisc = discAmt + pdiscAmt;

        const table = document.querySelector(".item-table tbody");
        const row = table.insertRow();
        row.innerHTML = `
      <td><button onclick="removeRow(this)">Del</button></td>
      <td>${code}</td>
      <td>${name}</td>
      <td>${amount.toFixed(2)}</td>
      <td>${disc}</td>
      <td>${discAmt.toFixed(2)}</td>
      <td>${pdisc}</td>
      <td>${pdiscAmt.toFixed(2)}</td>
      <td>${totalDisc.toFixed(2)}</td>
      <td></td>
      <td></td>
      <td>${remarks}</td>
    `;

        updateBillAmount();
        clearItemFields();
      }

      function removeRow(btn) {
        btn.closest("tr").remove();
        updateBillAmount();
      }

      function updateBillAmount() {
        const rows = document.querySelectorAll(".item-table tbody tr");
        let total = 0;
        rows.forEach((row) => {
          const amount = parseFloat(row.cells[3].innerText) || 0;
          total += amount;
        });
        document.getElementById("billAmount").value = total.toFixed(2);

        const received =
          parseFloat(document.getElementById("receivedAmount").value) || 0;
        document.getElementById("balanceAmount").value = (
          total - received
        ).toFixed(2);
      }

      document
        .getElementById("receivedAmount")
        .addEventListener("input", updateBillAmount);

      function clearItemFields() {
        [
          "itemcode",
          "itemname",
          "fee",
          "itemDisc",
          "itemPDisc",
          "remarks",
        ].forEach((id) => {
          document.getElementById(id).value = "";
        });
      }

      // Set default date
      document.getElementById("billDate").value = new Date()
        .toISOString()
        .slice(0, 16);
    </script> 
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<script>
		$(document).ready(function () {
		  $("#itemname").on("input", function () {
		    let query = $(this).val().trim();

		    if (query.length >= 1) {
		      $.ajax({
		        url: "/master/search",
		        data: { query: query },
		        success: function (items) {
		          let list = $("#suggestionList");
		          list.empty();
		          if (items.length === 0) {
		            list.hide();
		            return;
		          }
		          items.forEach(item => {
		            list.append(`<li data-code="${item.itemcode}" data-fee="${item.fee}" data-remarks="${item.remarks}">
		              ${item.itemname}
		            </li>`);
		          });
		          list.show();
		        },
		        error: function() {
		          $("#suggestionList").hide();
		        }
		      });
		    } else {
		      $("#suggestionList").hide();
		    }
		  });

		  // When a suggestion is clicked, autofill the item details
		  $(document).on("click", "#suggestionList li", function () {
		    let name = $(this).text().trim();
		    let code = $(this).data("code");
		    let fee = $(this).data("fee");
		    let remarks = $(this).data("remarks");

		    $("#itemname").val(name);
		    $("#itemcode").val(code);
		    $("#fee").val(fee);
		    $("#remarks").val(remarks);
		    $("#suggestionList").hide();
		  });

		  // Hide suggestions when clicking outside
		  $(document).on("click", function (e) {
		    if (!$(e.target).closest("#itemname, #suggestionList").length) {
		      $("#suggestionList").hide();
		    }
		  });
		});
//---------------------


$(document).ready(function () {
		  $("#itemcode").on("input", function () {
		    let query = $(this).val().trim();

		    if (query.length >= 1) {
		      $.ajax({
		        url: "/master/search",
		        data: { query: query },
		        success: function (items) {
		          let list = $("#suggestionListss");
		          list.empty();
		          if (items.length === 0) {
		            list.hide();
		            return;
		          }
		          items.forEach(item => {
		            list.append(`<li data-code="${item.itemcode}" data-fee="${item.fee}" data-remarks="${item.remarks}">
		              ${item.itemname}
		            </li>`);
		          });
		          list.show();
		        },
		        error: function() {
		          $("#suggestionListss").hide();
		        }
		      });
		    } else {
		      $("#suggestionListss").hide();
		    }
		  });

		  // When a suggestion is clicked, autofill the item details
		  $(document).on("click", "#suggestionListss li", function () {
		    let name = $(this).text().trim();
		    let code = $(this).data("code");
		    let fee = $(this).data("fee");
		    let remarks = $(this).data("remarks");

		    $("#itemname").val(name);
		    $("#itemcode").val(code);
		    $("#fee").val(fee);
		    $("#remarks").val(remarks);
		    $("#suggestionListss").hide();
		  });

		  // Hide suggestions when clicking outside
		  $(document).on("click", function (e) {
		    if (!$(e.target).closest("#itemcode, #suggestionListss").length) {
		      $("#suggestionListss").hide();
		    }
		  });
		});
	</script>

  </body>
</html>
